<!-- templates/gym/home.html -->
<!DOCTYPE html>
<html>
<head>
    <title>Спортзал "Энергия"</title>
    <style>
        .schedule { display: flex; gap: 30px; }
        .all-classes, .my-classes { flex: 1; }
        .class-card { border: 1px solid #ddd; padding: 15px; margin: 10px 0; }
        .my-class { background-color: #f0fff0; border-color: #4CAF50; }
        .warning { background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; }
        .guest-info { background-color: #e3f2fd; padding: 15px; margin-bottom: 20px; }
    </style>
</head>
<body>
    <!-- Навигация -->
    <div style="float: right;">
        {% if user.is_authenticated %}
            <p><strong>{{ user.username }}</strong> |
            {% if user.is_staff %}
                <a href="/admin/">Администратор</a> |
            {% endif %}
            <a href="{% url 'logout' %}">Выйти</a></p>
        {% else %}
            <a href="{% url 'login' %}">Войти</a> |
            <a href="{% url 'signup' %}">Регистрация</a>
        {% endif %}
    </div>

    <h1>Спортзал "Энергия"</h1>

    <!-- Список всех занятий (всегда виден) -->
    <div class="schedule">
        <div class="all-classes">
            <h2>Все занятия</h2>
            {% if all_classes %}
                {% for class in all_classes %}
                <div class="class-card">
                    <h3>{{ class.name }}</h3>
                    <p>Дата занятия: {{ class.start_time|date:"d.m.Y H:i" }}</p>
                    <p>Тренер: {{ class.trainer.user.get_full_name|default:"Тренер не указан" }}</p>
                    <p>Тип занятия: {{ class.workout_type.name|default:"Тип не указан" }}</p>
                    <p>Длительность:{{ class.duration }} мин</p>

                    <!-- Для подтвержденных клиентов -->
                    {% if user.is_authenticated and has_client_profile %}
                        {% if class in my_classes %}
                            <p style="color: green; font-weight: bold;">Вы записаны</p>
                        {% else %}
                            <p><button disabled>Записаться (скоро)</button></p>
                        {% endif %}
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <p>Занятий пока нет</p>
            {% endif %}
        </div>

        <!-- Блок для подтвержденных клиентов (мои занятия) -->
        {% if user.is_authenticated and has_client_profile %}
            <div class="my-classes">
                <h2>Мои занятия</h2>
                {% if my_classes %}
                    {% for class in my_classes %}
                    <div class="class-card my-class">
                        <h3>{{ class.name }}</h3>
                        <p>Дата занятия: {{ class.start_time|date:"d.m.Y H:i" }}</p>
                        <p>Тренер: {{ class.trainer.user.get_full_name|default:"Тренер не указан" }}</p>
                        <p>Тип занятия: {{ class.workout_type.name|default:"Тип не указан" }}</p>
                        <p>Длительность:{{ class.duration }} мин</p>
                        <p><button disabled>Отменить (скоро)</button></p>
                    </div>
                    {% endfor %}
                {% else %}
                    <p>У вас нет записей на занятия</p>
                    <p><small>Выберите занятие из списка слева и запишитесь на него через администратора</small></p>
                {% endif %}
            </div>
        {% endif %}
    </div>

    <!-- Блок для незарегистрированных пользователей -->
    {% if not user.is_authenticated %}
        <div class="guest-info">
            <h3>Для записи на занятия</h3>
            <p>Зарегистрируйтесь, чтобы получить возможность записываться на занятия!</p>
            <p><a href="{% url 'signup' %}">Зарегистрироваться</a> или <a href="{% url 'login' %}">Войти</a></p>
        </div>
    {% endif %}

    <!-- Блок для зарегистрированных без Client профиля -->
    {% if user.is_authenticated and not has_client_profile and not user.is_staff %}
        <div class="warning">
            <h3>Ожидание подтверждения профиля</h3>
            <p>Вы зарегистрированы как <strong>{{ user.username }}</strong>, но администратор ещё не создал ваш профиль клиента.</p>
            <p>Обратитесь к администратору для завершения регистрации и получения доступа к записи на занятия.</p>
            <p><em>Вы можете просматривать расписание, но записываться на занятия пока не можете.</em></p>
        </div>
    {% endif %}
</body>
</html>